<ng-template #forgotPasswordCard>
  <div class="auth-card">
    <div class="d-flex justify-content-end align-items-center">
      <button type="button" class="btn-close close-modal" aria-label="Close" (click)="closeModal()">
      </button>
    </div>

    <div class="logo-section">
      <img src="../../../assets/assets/logo.png" alt="Logo" />
      <h2>Forgot Password?</h2>
      <p>Enter your email to receive a password reset link</p>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="alert alert-danger">
      {{ errorMessage }}
    </div>  

    <!-- Success Message -->
    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
    </div>

    <form [formGroup]="forgotPasswordForm" (ngSubmit)="sendResetLink()" *ngIf="!emailSent">
      <div class="form-group">
        <label>Email Address</label>
        <input 
          type="email" 
          placeholder="you@example.com" 
          formControlName="email"
          [class.is-invalid]="forgotPasswordForm.get('email')?.invalid && forgotPasswordForm.get('email')?.touched"
        />
        <small 
          *ngIf="forgotPasswordForm.get('email')?.invalid && forgotPasswordForm.get('email')?.touched" 
          class="text-danger">
          Enter a valid email address
        </small>
      </div>

      <button 
        class="btn primary" 
        type="submit" 
        [disabled]="forgotPasswordForm.invalid || isLoading">
        {{ isLoading ? 'Sending...' : 'Send Reset Link' }}
      </button>
    </form>

    <!-- Success state - show after email sent -->
    <div *ngIf="emailSent" class="success-state">
      <div class="success-icon">✉️</div>
      <p class="text-center mt-3">Check your email for the reset link</p>
    </div>

    <div class="divider">or</div>

    <p class="switch-auth">
      Remember your password?
      <span (click)="backToLoginPage()">Back to Login</span>
    </p>
  </div>
</ng-template>

<!-- If used embedded (header) keep overlay behavior; otherwise render card only (modal) -->
<div *ngIf="embedded" class="modal-overlay" (click)="closeModal()">
  <main class="forgot-password-container" (click)="$event.stopPropagation()">
    <ng-container *ngTemplateOutlet="forgotPasswordCard"></ng-container>
  </main>
</div>

<div *ngIf="!embedded" class="forgot-password-modal-content">
  <ng-container *ngTemplateOutlet="forgotPasswordCard"></ng-container>
</div>

<!-- Close button for modal usage -->
<button *ngIf="!embedded" class="modal-card-close" (click)="closeModal()" aria-label="Close">✕</button>